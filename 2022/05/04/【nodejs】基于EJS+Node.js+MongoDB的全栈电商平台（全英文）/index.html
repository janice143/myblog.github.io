

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/myblog.github.io/img/favicon.ico">
  <link rel="icon" href="/myblog.github.io/img/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="iaine">
  <meta name="keywords" content="">
  
    <meta name="description" content="基于EJS+Node.js+MongoDB的全栈电商平台（全英文）Full stack ecommerce online store application    后台管理账号    用户名：admin   密码：123456         项目介绍本项目为基于EJS+Node.js+MongoDB技术实现的全栈电商平台，用户可以在平台上浏览，搜索所需商品，商家可以在后台上传商品信息并实时发布到">
<meta property="og:type" content="article">
<meta property="og:title" content="【nodejs】基于EJS+Node.js+MongoDB的全栈电商平台（全英文）">
<meta property="og:url" content="http://iainespace.work/portfolio/2022/05/04/%E3%80%90nodejs%E3%80%91%E5%9F%BA%E4%BA%8EEJS+Node.js+MongoDB%E7%9A%84%E5%85%A8%E6%A0%88%E7%94%B5%E5%95%86%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%85%A8%E8%8B%B1%E6%96%87%EF%BC%89/index.html">
<meta property="og:site_name" content="iaine&#39;s blog">
<meta property="og:description" content="基于EJS+Node.js+MongoDB的全栈电商平台（全英文）Full stack ecommerce online store application    后台管理账号    用户名：admin   密码：123456         项目介绍本项目为基于EJS+Node.js+MongoDB技术实现的全栈电商平台，用户可以在平台上浏览，搜索所需商品，商家可以在后台上传商品信息并实时发布到">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/janice143/myblog.github.io/blob/master/images/node_online_store.png?raw=true">
<meta property="og:image" content="c:/Users/superjanice/AppData/Roaming/Typora/typora-user-images/image-20220503160012828.png">
<meta property="article:published_time" content="2022-05-04T13:56:41.000Z">
<meta property="article:modified_time" content="2023-06-21T13:43:45.636Z">
<meta property="article:author" content="iaine">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://github.com/janice143/myblog.github.io/blob/master/images/node_online_store.png?raw=true">
  
  
  
  <title>【nodejs】基于EJS+Node.js+MongoDB的全栈电商平台（全英文） - iaine&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/myblog.github.io/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/myblog.github.io/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/myblog.github.io/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"iainespace.work","root":"/myblog.github.io/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/myblog.github.io/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/myblog.github.io/js/utils.js" ></script>
  <script  src="/myblog.github.io/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/myblog.github.io/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/myblog.github.io/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/myblog.github.io/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/myblog.github.io/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/myblog.github.io/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/myblog.github.io/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/myblog.github.io/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="【nodejs】基于EJS+Node.js+MongoDB的全栈电商平台（全英文）"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-05-04 21:56" pubdate>
          2022年5月4日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          10k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          87 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">【nodejs】基于EJS+Node.js+MongoDB的全栈电商平台（全英文）</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="基于EJS-Node-js-MongoDB的全栈电商平台（全英文）"><a href="#基于EJS-Node-js-MongoDB的全栈电商平台（全英文）" class="headerlink" title="基于EJS+Node.js+MongoDB的全栈电商平台（全英文）"></a>基于EJS+Node.js+MongoDB的全栈电商平台（全英文）</h1><p>Full stack ecommerce online store application</p>
<table>
<thead>
<tr>
<th><em>后台管理账号</em></th>
</tr>
</thead>
<tbody><tr>
<td>用户名：admin</td>
</tr>
<tr>
<td>密码：123456</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td></td>
</tr>
</tbody></table>
<h2 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h2><p>本项目为基于EJS+Node.js+MongoDB技术实现的全栈电商平台，用户可以在平台上浏览，搜索所需商品，商家可以在后台上传商品信息并实时发布到平台，供用户进行购买，数据库会实时向用户展示平台上的各种商品。</p>
<p>本项目是前后端分离开发，前后端功能需求完全独立，数据上相互依靠。前端包括以下几点的核心功能模块：1）商品列表展示模块；2）商品详情模块；3）商品分类展示模块；4）登录模块；5）注册模块；6）购物车模块；7）网站主页菜单栏编辑、添加、删除模块；8）商品类别编辑、添加、删除模块；9）商品信息编辑、添加、删除模块。</p>
<p>后端主要实现的功能为：1）按类名查询商品列表功能；2）用户登录和注册功能；3）对购物车相应数据的增加、删除、更新和清空功能；4）订单支付功能；5）对商品类别的数据增加、编辑、删除功能；6）对商品的数据增加、编辑、删除功能；7）对网站主页菜单栏的数据增加、编辑、删除功能</p>
<p>本项目采用的技术是：</p>
<p>前端：bootstrap, ejs</p>
<p>后端：node.js,  express, express-router, stripe, mongodb, mongoose,  express-validator, dropzone, passport</p>
<h2 id="项目功能界面"><a href="#项目功能界面" class="headerlink" title="项目功能界面"></a>项目功能界面</h2><p><img src="https://github.com/janice143/myblog.github.io/blob/master/images/node_online_store.png?raw=true" srcset="/myblog.github.io/img/loading.gif" lazyload></p>
<h2 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h2><h3 id="1-功能模块分析"><a href="#1-功能模块分析" class="headerlink" title="1 功能模块分析"></a>1 功能模块分析</h3><p>前端采用bootstrap框架来实现页面的快速响应式布局记忆快速搭建。同时使用了EJS这类高效的嵌入式 JavaScript 模板引擎，用来实现动态的数据渲染。后端基于Nodejs 的Express 服务架构，使用非关系型数据库MongoDB 数据支持。整个系统使用流行的MVC 框架结构，实现了表现层、逻辑层和数据层的分离。<br>系统完成之后，可以为买家用户提供商品浏览购买等服务，为卖家提供商品以及商品类别的增添、删除和编辑等功能。</p>
<p>（1）商品列表展示模块：实现商品列表的整体布局和组件拆分，根据服务器响应的数据，以及EJS模板引擎实现动态地渲染页面。</p>
<p>（2）商品分类展示模块：使用mongoose的数据库查找功能，按照商品类别（category），查找对应的商品，并把数据给页面进行展示。</p>
<p>（3）登录模块：主要实现网站的登录，和用户校验功能，当用户未进行登录时不可以对购买商品进行加入购物车操作，只能进行商品的查看，在后台中添加请求拦截可以实现此功能。用户登录后可以实现加入购物车以及购买商品等一系列操作。</p>
<p>（4）注册模块：主要实现网站账号的注册，注册过程中有些文本框需要满足一定的要求，比如用户名，名字等不能为空，利用express-validator来实现校验。</p>
<p>（5）购物车模块：把商品加入购物车后回显示商品的数目，购物车结算页面中可以进行商品的增加、减少，清除功能。最后还包括对整个购物车的一键清除，以及支付功能。其中支付功能采用了stripe的接口，可以利用stripe的卡号来进行实际的支付功能。</p>
<p><del>88888888—除了上述列出的一系列重要模块之外，本系统还利用—88888888888</del></p>
<h3 id="2-数据库设计"><a href="#2-数据库设计" class="headerlink" title="2 数据库设计"></a>2 数据库设计</h3><p>采用MongoDB数据库，这种非关系型数据库拥有以json格式进行数据传输与存储，没有烦琐的业务关系的处理，并且与node.js兼容性非常的良好。采用MongoDB 数据库中自带的Mongoose 类库作为中间件解决数据集合中数据操作问题，并且使用MongoDBCompass图形化管理数据。</p>
<p>本系统准备了四张表，名字分别为category（存储商品类名信息），page（存储主页导航栏信息），product（存储商品信息），user（存储用户信息）。</p>
<h3 id="3-前端路由"><a href="#3-前端路由" class="headerlink" title="3 前端路由"></a>3 前端路由</h3><p><img src="C:\Users\superjanice\AppData\Roaming\Typora\typora-user-images\image-20220503160012828.png" srcset="/myblog.github.io/img/loading.gif" lazyload alt="image-20220503160012828"></p>
<h2 id="项目开发详解"><a href="#项目开发详解" class="headerlink" title="项目开发详解"></a>项目开发详解</h2><h3 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h3><p> 1 npm init</p>
<p>2 新建server.js文件</p>
<p>3 安装express包 npm i –save express。在server.js文件中编写下述代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> app = express()<br><br>app.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;<br>  res.send(<span class="hljs-string">&#x27;Hello World&#x27;</span>)<br>&#125;)<br><br>app.listen(<span class="hljs-number">3000</span>)<br></code></pre></td></tr></table></figure>

<p>4 在控制台中输入命令 node server.js .一个nodejs服务器就启动了</p>
<p>访问: <a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000</a></p>
<h3 id="项目源码目录设计"><a href="#项目源码目录设计" class="headerlink" title="项目源码目录设计"></a>项目源码目录设计</h3><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs md">config 文件夹 配置mongodb服务器、用户登录的passport等<br>models 文件夹 mongoose的数据模型<br>public 文件夹 放一些静态的css,js以及图片等，产品图片也会通过建立文件夹的形式存储在本文件夹中<br>routes 文件夹 存放路由<br>views 文件夹 视图层，用来渲染数据<br>.env 文件 环境变量配置，用来存放一些重要、敏感的信息，比如密钥等<br><br></code></pre></td></tr></table></figure>

<h3 id="项目用到的库和插件"><a href="#项目用到的库和插件" class="headerlink" title="项目用到的库和插件"></a>项目用到的库和插件</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs markdown">express node.js Web应用框架, 提供各种特性和丰富的 HTTP 工具实现各种 Web 应用的创建。可以快速地搭建一个完整功能的网站。<br><br>ejs JS模板引擎，模板文件后缀.ejs，&lt;% 内容 %&gt;。语法简单，上手容易<br><br>body-parser 一般用到express框架都需要用这个中间件，用于处理 JSON, Raw, Text 和 URL 编码的数据。通俗地讲，用了body-parser中间件之后，我们的请求对象中就多了一个body属性，可以通过req.body显示出传入参数。(可以参考这篇博客 https://segmentfault.com/a/1190000041169686)<br><br>express-session 服务器储存。在本项目中用来存储用户购物车一类的数据<br><br>express-validator 表单验证器<br><br>express-messages 提供Flash 通知渲染<br><br>express-fileupload 接受从客户端传来的图片，并将图片作为文件存储在服务端<br><br>fs-extra 文件操作，fs的一个扩展，提供了非常多的便利API，并且继承了fs所有方法和为fs方法添加了promise的支持<br><br>mkdirp 不仅可以创建文件夹，还可以创建多层的文件夹<br><br>connect-flash flash通知<br><br>Mongoose 在 nodeJs 异步环境下对 mongodb 进行便捷操作的对象模型工具。<br><br>bcryptjs 密码加密以及解密匹配<br>passport 登录验证（身份认证的一种），功能单一，只能做登录验证，但非常强大，支持本地账号验证和第三方账号登录验证（OAuth和OpenID等），支持大多数Web网站和服务<br>passport-local passport的依赖包，本地认证，本地身份验证<br><br>resize-img 调整图片大小，比如说奥村图片的时候，重新调大小<br><br>sortablejs JavaScript 拖拽库。可用于列表拖拽排序、以及低代码拖拽配置等场景<br><br>stripe 支付接口<br><br>bootstrap 基于HTML、CSS、JavaScript的前端框架,响应式前端布局<br><br>dropzone 文件拖拽上传功能<br><br>fileupload 实现图片上传<br><br>viewerjs  大图预览（https://github.com/fengyuanchen/viewerjs）<br></code></pre></td></tr></table></figure>

<h4 id="Express-Messages的基本使用"><a href="#Express-Messages的基本使用" class="headerlink" title="Express Messages的基本使用"></a>Express Messages的基本使用</h4><p>作用：提供flash通知的渲染</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">app.use(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;connect-flash&#x27;</span>)());<br>app.use(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  res.locals.messages = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express-messages&#x27;</span>)(req, res);<br>  next();<br>&#125;);<br>req.flash(<span class="hljs-string">&quot;info&quot;</span>, <span class="hljs-string">&quot;Email queued&quot;</span>);<br>req.flash(<span class="hljs-string">&quot;info&quot;</span>, <span class="hljs-string">&quot;Email sent&quot;</span>);<br>req.flash(<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-string">&quot;Email delivery failed&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>渲染messages, 根据所使用的的模板引擎执行messages函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ejs">EJS:<br>&lt;%- messages() %&gt;<br></code></pre></td></tr></table></figure>

<h4 id="Connect-Flash的基本使用"><a href="#Connect-Flash的基本使用" class="headerlink" title="Connect Flash的基本使用"></a>Connect Flash的基本使用</h4><p>flash是配合session使用的，所以在使用flash之前，要引入express-session模块，它往往用在登录和注册，消息只会通知一次就消失了，其中redirect和flash是不能分开使用的。</p>
<p>With the <code>flash</code> middleware in place, all requests will have a <code>req.flash()</code> function that can be used for flash messages.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">app.get(<span class="hljs-string">&#x27;/flash&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>)</span>&#123;<br>  <span class="hljs-comment">// Set a flash message by passing the key, followed by the value, to req.flash().</span><br>  req.flash(<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-string">&#x27;Flash is back!&#x27;</span>)<br>  res.redirect(<span class="hljs-string">&#x27;/&#x27;</span>);<br>&#125;);<br><br>app.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>)</span>&#123;<br>  <span class="hljs-comment">// Get an array of flash messages by passing the key to req.flash()</span><br>  res.render(<span class="hljs-string">&#x27;index&#x27;</span>, &#123; <span class="hljs-attr">messages</span>: req.flash(<span class="hljs-string">&#x27;info&#x27;</span>) &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h4 id="Mongoose基本使用"><a href="#Mongoose基本使用" class="headerlink" title="Mongoose基本使用"></a>Mongoose基本使用</h4><p><em>本部分内容主要参考了这篇博客，因为这篇文章写得很详细，想看更多细节，可以点击<a target="_blank" rel="noopener" href="https://juejin.cn/post/6918945758968283144">链接</a></em></p>
<h5 id="1-引入-mongoose-并连接数据库"><a href="#1-引入-mongoose-并连接数据库" class="headerlink" title="1 引入 mongoose 并连接数据库"></a>1 引入 mongoose 并连接数据库</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);<br>mongoose.connect(<span class="hljs-string">&#x27;mongodb://localhost/test&#x27;</span>); <br>如果有账户密码需要采用下面的连接方式： <br>mongoose.connect(<span class="hljs-string">&#x27;mongodb://eggadmin:123456@localhost:27017/eggcms&#x27;</span>); <br>复制代码<br></code></pre></td></tr></table></figure>

<h5 id="2-定义-Schema"><a href="#2-定义-Schema" class="headerlink" title="2 定义 Schema"></a>2 定义 Schema</h5><p>数据库中的 Schema，为数据库对象的集合。schema 是 mongoose 里会用到的一种数据模式， 可以理解为表结构的定义；每个 schema 会映射到 mongodb 中的一个 collection，它不具备 操作数据库的能力</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> PageSchema = <span class="hljs-keyword">new</span> mongoose.Schema(&#123;<br>    <span class="hljs-attr">title</span>:&#123;<br>        <span class="hljs-attr">type</span>:<span class="hljs-built_in">String</span>,<br>        <span class="hljs-attr">required</span>:<span class="hljs-literal">true</span><br>    &#125;,<br>    <span class="hljs-attr">slug</span>:&#123;<br>        <span class="hljs-attr">type</span>:<span class="hljs-built_in">String</span>,<br>    &#125;,<br>    <span class="hljs-attr">content</span>:&#123;<br>        <span class="hljs-attr">type</span>:<span class="hljs-built_in">String</span>,<br>        <span class="hljs-attr">required</span>:<span class="hljs-literal">true</span><br>    &#125;,<br>    <span class="hljs-attr">sorting</span>:&#123;<br>        <span class="hljs-attr">type</span>:<span class="hljs-built_in">Number</span>,<br>    &#125;,<br>  &#125;);<br></code></pre></td></tr></table></figure>

<h5 id="3-创建数据模型"><a href="#3-创建数据模型" class="headerlink" title="3 创建数据模型"></a>3 创建数据模型</h5><p>定义好了 Schema，接下就是生成 Model。model 是由 schema 生成的模型，可以对数据库的 操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> Page = mongoose.model(<span class="hljs-string">&#x27;page&#x27;</span>, PageSchema);<br></code></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<ul>
<li><code>mongoose.model</code> 里面可以传入两个参数也可以传入三个参数</li>
<li><code>mongoose.model</code>（参数 1:模型名称，参数 2:Schema）</li>
<li><code>mongoose.model</code>（参数 1:模型名称，参数 2:Schema，参数 3:数据库集合名称）</li>
<li>如果传入 2 个参数的话，这个模型会和模型名称相同的复数的数据库建立连接：如通过下面 方法创建模型，那么这个模型将会操作 users 这个集合。</li>
</ul>
<h5 id="4-查找数据"><a href="#4-查找数据" class="headerlink" title="4 查找数据"></a>4 查找数据</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">UserModel.find(&#123;&#125;, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, docs</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (err) &#123;<br>    <span class="hljs-built_in">console</span>.log(err);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-built_in">console</span>.log(docs);<br>&#125;);<br><br></code></pre></td></tr></table></figure>

<h5 id="5-增加数据"><a href="#5-增加数据" class="headerlink" title="5 增加数据"></a>5 增加数据</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//实例化模型 传入增加的数据</span><br><span class="hljs-keyword">var</span> u = <span class="hljs-keyword">new</span> UserModel(&#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;lisi2222&quot;</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>,<br>  <span class="hljs-attr">status</span>: <span class="hljs-literal">true</span><br>&#125;);<br>u.save();<br>复制代码<br></code></pre></td></tr></table></figure>

<h5 id="6-修改数据"><a href="#6-修改数据" class="headerlink" title="6 修改数据"></a>6 修改数据</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">UserModel.updateOne(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;lisi2222&quot;</span> &#125;, &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;哈哈哈&quot;</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, res</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (err) &#123;<br>    <span class="hljs-built_in">console</span>.log(err);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;成功&quot;</span>);<br>&#125;);<br>复制代码<br></code></pre></td></tr></table></figure>

<h5 id="7-删除数据"><a href="#7-删除数据" class="headerlink" title="7 删除数据"></a>7 删除数据</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">UserModel.deleteOne(&#123; <span class="hljs-attr">_id</span>: <span class="hljs-string">&quot;5b72ada84e284f0acc8d318a&quot;</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (err) &#123;<br>    <span class="hljs-built_in">console</span>.log(err);<br>    <span class="hljs-keyword">return</span>;<br>  &#125; <br>  <span class="hljs-comment">//只会删除一条</span><br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;成功&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>




<h4 id="bcryptjs基本使用"><a href="#bcryptjs基本使用" class="headerlink" title="bcryptjs基本使用"></a>bcryptjs基本使用</h4><p><code>bcryptjs</code> 是nodejs中比较好的一款加盐(<code>salt</code>)加密的包, 我们处理密码加密、校验要使用到的两个方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 加密处理 - 同步方法</span><br><span class="hljs-comment"> * bcryptjs.hashSync(data, salt)</span><br><span class="hljs-comment"> *    - data  要加密的数据</span><br><span class="hljs-comment"> *    - slat  用于哈希密码的盐。如果指定为数字，则将使用指定的轮数生成盐并将其使用。推荐 10</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> hashPassword = bcryptjs.hashSync(password, <span class="hljs-number">10</span>)<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 校验 - 使用同步方法</span><br><span class="hljs-comment"> * bcryptjs.compareSync(data, encrypted)</span><br><span class="hljs-comment"> *    - data        要比较的数据, 使用登录时传递过来的密码</span><br><span class="hljs-comment"> *    - encrypted   要比较的数据, 使用从数据库中查询出来的加密过的密码</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> isOk = bcryptjs.compareSync(password, encryptPassword)<br></code></pre></td></tr></table></figure>



<h4 id="路由介绍"><a href="#路由介绍" class="headerlink" title="路由介绍"></a>路由介绍</h4><p>路由（Routing）是由一个 URI（或者叫路径）和一个特定的 HTTP 方法（GET、POST 等）组成的，涉及到应用如何响应客户端对某个网站节点的访问。</p>
<p>每一个路由都可以有一个或者多个处理器函数，当匹配到路由时，这个/些函数将被执行</p>
<h4 id="express-session"><a href="#express-session" class="headerlink" title="express-session"></a>express-session</h4><p><a target="_blank" rel="noopener" href="http://blog.inode.club/cookie-session-token305/">http://blog.inode.club/cookie-session-token305/</a></p>
<h4 id="express-validator"><a href="#express-validator" class="headerlink" title="express-validator"></a>express-validator</h4><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903854195081223">https://juejin.cn/post/6844903854195081223</a></p>
<h2 id="项目中遇到的问题"><a href="#项目中遇到的问题" class="headerlink" title="项目中遇到的问题"></a>项目中遇到的问题</h2><h3 id="1-a标签的点击事件以及href跳转的问题"><a href="#1-a标签的点击事件以及href跳转的问题" class="headerlink" title="1 a标签的点击事件以及href跳转的问题"></a>1 a标签的点击事件以及href跳转的问题</h3><p>在项目中，我需要设计一个<strong>删除</strong>按钮（是一个a标签），点击后会弹出确认窗口，如果取消删除，则不发生任何操作。如果点击确定（删除），那么就会进行href的一个路由跳转。</p>
<p>a标签的click 事件是在页面开始跳转之前执行的。正常情况下，如果给a标签添加一个click点击事件，比如说执行一些打印操作，控制台会很快刷新一下的。因为a标签有默认的一个href跳转动作（默认事件），在执行完打印操作后，页面会很快跳转，这是控制台就已经被刷新了。</p>
<p>如果要阻止这个默认事件，可以使用e.preventDefalt()。</p>
<p>参考链接</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/14867558/html-tag-a-want-to-add-both-href-and-onclick-working">HTML tag  want to add both href and onclick working</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://www.xinxiaoyang.com/programming/2017-03-06-a-tag-with-onclick-event/">a 标签的 href 属性和 onclick 事件</a></p>
</li>
</ul>
<h3 id="2-mkdirp-slower-than-fileupload"><a href="#2-mkdirp-slower-than-fileupload" class="headerlink" title="2 mkdirp slower than fileupload"></a>2 mkdirp slower than fileupload</h3><p>项目中使用mkdirp插件实现多层文件夹的操作，建完文件夹后，需要把图片保存在对应的文件夹中，但这时候我遇到了问题：<strong>No such file or directory</strong>，经观察，我发现创造文件更慢，以至于后面上传文件的时候，没有文件夹。这就是程序报错的原因：。</p>
<p>更重要的原因是mkdirp这个函数是异步的。因此，可以在异步执行完后返回的promise中使用then方法，继续下面的程序</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js">mkdirp(<span class="hljs-string">&#x27;public/product_images/&#x27;</span>+ product._id).then(<span class="hljs-function"><span class="hljs-params">made</span> =&gt;</span><br>                                                   &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`made directories, starting with <span class="hljs-subst">$&#123;made&#125;</span>`</span>)<br>    <span class="hljs-keyword">if</span>(imageFile !== <span class="hljs-string">&quot;&quot;</span>)&#123;<br>        <span class="hljs-keyword">let</span> productImage = req.files.image;<br>        <span class="hljs-comment">// console.log(productImage)</span><br>        <span class="hljs-keyword">const</span> filepath = <span class="hljs-string">&#x27;public/product_images/&#x27;</span>+ product._id+<span class="hljs-string">&#x27;/&#x27;</span> + imageFile;<br>        <span class="hljs-comment">// 文件上传</span><br>        productImage.mv(filepath,<span class="hljs-function"><span class="hljs-params">err</span>=&gt;</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.log(err)<br>        &#125;)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-request-files获取不到文件的解决方案"><a href="#3-request-files获取不到文件的解决方案" class="headerlink" title="3 request.files获取不到文件的解决方案"></a>3 request.files获取不到文件的解决方案</h3><p>在form表单中发送post请求的时候，需要给服务器一些图片，但是我在req.files上找不到。后来发现是我在form标签了，没有加上 enctype=”multipart/form-data” 的属性。</p>
<p>要确保能在req.files上获取文件，要确保一些几点：</p>
<ol>
<li><p>保证页面中的上传文件标记里都包含name属性。</p>
</li>
<li><p>必须在form上添加 enctype=”multipart/form-data” 的属性。</p>
</li>
</ol>
<p>这样后台就可以正常获取input type=”file”提交过来的文件里。</p>
<h3 id="4-管理台新添page-或者顺序改变，如果不重启服务器，用户主页不会更新"><a href="#4-管理台新添page-或者顺序改变，如果不重启服务器，用户主页不会更新" class="headerlink" title="4 管理台新添page,或者顺序改变，如果不重启服务器，用户主页不会更新"></a>4 管理台新添page,或者顺序改变，如果不重启服务器，用户主页不会更新</h3><p>解决办法是在管理台的adminPages.js文件上，及时更改全局的pages变量，也就是<em>req</em>.app.locals.pages</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">Page.find(&#123;&#125;).sort(&#123;<span class="hljs-attr">sorting</span>:<span class="hljs-number">1</span>&#125;).exec(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,pages</span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(err) <span class="hljs-built_in">console</span>.log(err)<br>    <span class="hljs-comment">// set global pages variable</span><br>    req.app.locals.pages = pages;<br>&#125;)<br></code></pre></td></tr></table></figure>

<h3 id="5-相对路径和绝对路径的问题"><a href="#5-相对路径和绝对路径的问题" class="headerlink" title="5 相对路径和绝对路径的问题"></a>5 相对路径和绝对路径的问题</h3><p>/product_images和product_images路径的区别，前者绝对路径（localhost:3000/product_images)，后者是相对路径(localhost:3000/当前路径/product_images) app.use(‘/当前路径’)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">os.mkdir(<span class="hljs-string">&#x27;dir_name&#x27;</span>) // 相对路径<br>os.mkdir(<span class="hljs-string">&#x27;/dir_name&#x27;</span>) //绝对路径<br></code></pre></td></tr></table></figure>

<h3 id="6-using-findOne-inside-a-foreach"><a href="#6-using-findOne-inside-a-foreach" class="headerlink" title="6 using findOne inside a foreach()"></a>6 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/65538826/using-findone-inside-a-foreach">using findOne inside a foreach()</a></h3><p>由于mongoose数据查询是异步操作，所以如果我在for循环下查找数据库的话会出现问题。</p>
<p>这个问题出现的场景是，我想在用stripe结账的时候，从服务器上计算total总价格，因此我采用前端传过来的购买商品名字和数量这两个信息，去服务器里匹配对应的商品价格，然后计算total。但是我每次stripe接口结账的时候total为0，而stripe接口必须支付打印1cent以上的金额。所以就出现了程序报错。</p>
<p>查找了很多资料，有说下面的程序可以解决，但是我试了不可行。但这里我这个方法我还是想做个标记，因为我对异步不是理解得很透彻。</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs clojure">(<span class="hljs-name">async</span> () =&gt; &#123;<br>    for (<span class="hljs-name">const</span> question of questionList) &#123;<br>    await questionAction(<span class="hljs-name">question</span>)<span class="hljs-comment">;</span><br>    &#125;<br>&#125;)()<br></code></pre></td></tr></table></figure>

<p>最后我找到了解决问题的思路，就是数据库接口的设计问题，一个数据库不止可以实现findOne查找，还有findAll查找。为什么要每次在for循环下findOne呢？这很明显不符合数据库接口的设计思路，多次访问数据库也会给服务器带来很多负担。</p>
<p>所以应该优化这个查询思路，就是一次性找出所有的数据，找出来后再进行计算。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs js">Product.find(&#123;<span class="hljs-attr">slug</span>:titles&#125;,<span class="hljs-function">(<span class="hljs-params">err,products</span>)=&gt;</span>&#123;<br>    <span class="hljs-keyword">if</span>(err) <span class="hljs-built_in">console</span>.log(err);<br>    <span class="hljs-comment">// console.log(item,product)</span><br>    <span class="hljs-keyword">if</span>(products)&#123;<br>        <span class="hljs-comment">// prices.push(product.price)</span><br>        products.forEach(<span class="hljs-function">(<span class="hljs-params">product,i</span>)=&gt;</span>&#123;<br>            <span class="hljs-comment">// console.log(product.title,req.body.items[i])</span><br>            total += product.price * req.body.items[i].quantity<br>        &#125;)<br>        <span class="hljs-built_in">console</span>.log(total)<br>        <span class="hljs-comment">// stripe的total是用美分计算的，，所以要*100</span><br>        stripe.charges.create(&#123;<br>            <span class="hljs-comment">// total金额要在1美元以上</span><br>            <span class="hljs-attr">amount</span>: <span class="hljs-built_in">parseFloat</span>(total).toFixed(<span class="hljs-number">2</span>)*<span class="hljs-number">100</span>,<br>            <span class="hljs-attr">source</span>: req.body.stripeTokenId,<br>            <span class="hljs-attr">currency</span>: <span class="hljs-string">&#x27;usd&#x27;</span><br>        &#125;).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-comment">// 清空购物车</span><br>            <span class="hljs-keyword">delete</span> req.session.cart<br>            <span class="hljs-comment">// You&#x27;re using a res in the then callback, and that one shadows the res from the router.post. </span><br>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;Charge Successful&#x27;</span>)<br>            res.json(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Successfully purchased items&#x27;</span> &#125;)<br><br>        &#125;).catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>&#123;           <br>            <span class="hljs-built_in">console</span>.log(e.message,<span class="hljs-string">&#x27;Charge Fail&#x27;</span>)<br>            res.status(<span class="hljs-number">500</span>).end()<br>        &#125;)<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>解决问题过程中查找的资料：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/blueblueskyhua/article/details/53783092">解决mongoose数据查询的异步操作</a></p>
</li>
<li><p>How to call a mongoose findOne inside the forEach before the answer?<a target="_blank" rel="noopener" href="https://helperbyte.com/questions/438636/how-to-call-a-mongoose-findone-inside-the-foreach-before-the-answer"></a></p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://www.hpnews.online/topic/57822a8aee5f048d54f9081b&auther=weapon-xx">如何优雅的解决循环里的异步查询</a>？（主要是这个博客点醒了我！！！！）</p>
<h3 id="7-res-redirect-is-not-a-function-in-promise-then"><a href="#7-res-redirect-is-not-a-function-in-promise-then" class="headerlink" title="7 res.redirect is not a function in promise then"></a>7 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/50427032/res-redirect-is-not-a-function-in-promise-then">res.redirect is not a function in promise then</a></h3><p>res.redirect cant work in then promise</p>
<h2 id="项目未来的一些优化想法"><a href="#项目未来的一些优化想法" class="headerlink" title="项目未来的一些优化想法"></a>项目未来的一些优化想法</h2><p>1 采用懒加载的加载模式，大大提高了页面的加载速度，提高用户体验，降低了后台API请求数据的压力。</p>
<p>2 权限跳转 <a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904033660977159">https://juejin.cn/post/6844904033660977159</a></p>
<p>3 jwt 方式，标识用户身份</p>
<p>服务器验证成功后应该签发一个身份标识的东西给客户端，这样以后客户端就拿着这个标识来证明自己的身份。而标识用户身份的方式有多种，这里我们采用<code>jwt</code>方式</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7044708915438682148">https://juejin.cn/post/7044708915438682148</a></p>
<p>4 后台管理中，pages 编辑的内容。可以用一些插件修改文字的样式，比如 CKeditor</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这个项目大概做了8天。写博客也花了好几个小时。甚至中途都有点想为啥我要花这么久时间写博客，太费时间了。后来我想通了，我目前的学习不是很沉淀，我需要做笔记来加深我对前端知识的理解。所以我应该坚持。</p>
<p>最近比较忙碌的一段时间，本来想找实习的，但是来不及了，感觉没有准备好。还有这个月中旬由有教资面试（虽然我不打算当老师），但是我就是想拿到这个证，所以我就下定决心要花时间拿到。这个月还想开始联系博导，虽然我的最终目标是硕士毕业工作，做前端开发，但是我本科就有一些文章和成果，所以还是想看看这些东西能不能找个985博士读读。</p>
<p>最近几个月我还想复习我的光学专业知识，感觉专业上用的中文教材都不是很好，没讲清楚很多东西，所以我找一下国外教材重新复习一下。一下子这么多事情我感觉很烦躁，随便一项工作都要花时间，有些东西最对我来水可能以后还用不到，但是我一想到这点，我就觉得我不能这样想，我不能因为他有用而去学。相反，任何东西都很有用，我应该抱着热爱、兴趣的态度去学习。如果我要是不喜欢，那我才应该真正的放弃。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>【nodejs】基于EJS+Node.js+MongoDB的全栈电商平台（全英文）</div>
      <div>http://iainespace.work/portfolio/2022/05/04/【nodejs】基于EJS+Node.js+MongoDB的全栈电商平台（全英文）/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>iaine</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年5月4日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/myblog.github.io/2022/05/20/%E3%80%90%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95-VUE%E3%80%91VUE%E5%90%88%E9%9B%86/" title="【前端面试-VUE】VUE合集">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">【前端面试-VUE】VUE合集</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/myblog.github.io/2022/04/15/%E3%80%90ejs%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E3%80%91%E7%AC%AC%E4%B8%80%E6%AC%A1%E7%94%A8ejs/" title="【ejs模板引擎】第一次用ejs">
                        <span class="hidden-mobile">【ejs模板引擎】第一次用ejs</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/myblog.github.io/js/events.js" ></script>
<script  src="/myblog.github.io/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/myblog.github.io/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/myblog.github.io/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/myblog.github.io/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
